<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Bootstrap required meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>CoEditor</title>
    <script src="js/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
<div id="main" class="container-fluid" style="height: 100vh">

    <div class="row">
        <h1 class="col-3">CoEditor</h1>
        <template v-if="username.length > 0">
            <div class="text-right col-9">
                <p class="text-dark"><em>You are logged in as: {{ username }}</em><br> <a href="#" @click="logout">Log
                    out</a></p>
            </div>
        </template>
    </div>

    <div class="row justify-content-center" style="height: 75vh;">

        <div class="col-4">

            <div class="row">
                <div class="col-12">
                    <label class="col-form-label font-weight-bold">&nbsp;</label>
                    <div class="input-group mb-3">
                        <input id="docName" v-model.trim="documentName" placeholder="Type a name for new document"
                               class="form-control col-8">
                        <button data-toggle="tooltip" title="create new!"
                                @click="createDocument" type="button" class="btn btn-primary col-4 ml-1">Create Document
                        </button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="card mb-2 h-100">
                        <h4 class="card-header">Available documents</h4>
                        <div class="pre-scrollable col-12 card-body">
                            <div v-if="docs.length && docs.length>0" class="list-group h-100">
                                <button v-for="doc in docs" class="list-group-item list-group-item-action"
                                        @click="loadDocument(doc.id)">
                                    {{ doc.name }}
                                </button>
                            </div>
                            <p v-else>There are no documents. Create new!</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-warning" v-if="docNameError.length > 0">
                <button type="button" class="close" @click="closeDocNameWarning">&times;</button>
                <p>{{ docNameError }}</p>
            </div>

        </div>

        <div class="col-8">
            <div class="row">
                <div class="col-6">

                    <template v-if="currentDocument">

                        <div v-if="!labellingMode" class="btn-group">
                            <div class="btn-group">
                                <button id="btn1" type="button" class="btn btn-outline-primary dropdown-toggle"
                                        data-toggle="dropdown"></button>
                                <div class="dropdown-menu" aria-labelledby="btn1" x-placement="bottom-start"
                                     style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 37px, 0px);">
                                    <div class="pre-scrollable" style="height: 200px;">
                                        <a v-for="version in docVersions" class="dropdown-item" href="#"
                                           @click="loadLabelledDocument(currentDocument.primaryKey.documentId, version)">
                                            {{ version }}
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <button v-bind:disabled="observingOldVersion"
                                    type="button" class="btn btn-outline-primary" @click="labellingMode=true"
                                    data-toggle="tooltip" title="label this version!">
                                <em>{{ currentDocument.document.name }}</em>,
                                <span v-if="!observingOldVersion">last edit</span>
                                <span v-else>edited</span> on:
                                {{ currentDocument.primaryKey.modificationTime }}
                            </button>
                            <button v-if="observingOldVersion" type="button" class="btn btn-outline-primary"
                                    @click="loadDocument(currentDocument.primaryKey.documentId)"
                                    data-toggle="tooltip"
                                    title="return to the latest version">
                                &#10227;
                            </button>
                        </div>
                        <div v-else class="input-group">

                            <button type="button" class="btn btn-outline-primary"
                                    data-toggle="tooltip"
                                    title="cancel"
                                    @click="labellingMode = false">
                                &times;
                            </button>
                            <input v-model.trim="versionLabel" class="form-control" placeholder="Type version label here">
                            <button type="button" class="btn btn-outline-primary"
                                    @click="pushDocumentVersion"
                                    title="save version!"
                                    v-bind:disabled="versionLabel.trim().length == 0 || versionLabel.trim() == 'all'">&#x2713;
                            </button>
                        </div>
                    </template>
                    <label v-else class="col-form-label">&nbsp;</label>

                </div>
                <div class="col-6 text-right">
                    <label v-if="activeUsers.length > 0"
                           class="col-form-label"><i>{{ activeUsers }}</i></label>
                </div>
            </div>

            <div class="row justify-content-center h-100">
                <div class="col-12">
                    <template v-if="currentDocument">
                    <textarea v-if="processStatus != ProcessStatus.fetching && !observingOldVersion"
                              class="form-control h-100"
                              v-model="documentData"></textarea>
                        <textarea v-else disabled class="form-control h-100" v-model="documentData"></textarea>

                        <div class="row justify-content-center">
                            <template v-if="processStatus == ProcessStatus.idle">
                                <label class="col-form-label text-muted" v-if="commitStatus == CommitStatus.noData">
                                    no data
                                </label>
                                <label class="col-form-label text-muted"
                                       v-else-if="commitStatus == CommitStatus.justLoaded">
                                    just loaded
                                </label>
                                <label class="col-form-label text-muted"
                                       v-else-if="commitStatus == CommitStatus.modified">
                                    modified, preparing to push...
                                </label>
                                <label class="col-form-label text-muted"
                                       v-else-if="commitStatus == CommitStatus.pushed">
                                    changes saved
                                </label>
                                <label class="col-form-label text-muted"
                                       v-else-if="commitStatus == CommitStatus.fetched">
                                    fetched
                                </label>
                            </template>
                            <label v-else-if="processStatus == ProcessStatus.pushing" class="col-form-label text-muted">
                                pushing...
                            </label>
                            <label v-else-if="processStatus == ProcessStatus.fetching"
                                   class="col-form-label text-muted">
                                fetching...
                            </label>
                        </div>
                    </template>
                    <textarea v-else disabled
                              class="form-control h-100">select document to edit</textarea>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="js/main.js"></script>

<!-- Bootstrap -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>
</body>
</html>